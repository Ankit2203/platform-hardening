variables:
  - name: watcherTrigger
    value: 'INPUT/watcher_automation_input.xlsm'

  - name: ruleTrigger
    value: 'INPUT/rules_automation_input.xlsm'

jobs:
- job: RunPythonScriptWatcher
  pool:
    vmImage: 'ubuntu-latest'
  displayName: 'Run Python Script for Watcher'
  condition: contains(variables['Build.SourceTfvcRunAllTests'], variables['watcherTrigger'])
  steps:
    - checkout: self
    - task: UsePythonVersion@0
      inputs:
        versionSpec: '3.x'
        addToPath: true
        architecture: 'x64'
    - script: |
        echo "Build.SourcePath: $(Build.SourceTfvcRunAllTests)"
        pip install -r requirements.txt
        python AUTOMATION/watcher_automation.py
    - task: CopyFiles@2
      inputs:
        targetFolder: '$(Build.ArtifactStagingDirectory)'
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Build.ArtifactStagingDirectory)'
        ArtifactName: 'drop02'
        publishLocation: 'Container'

- job: RunPythonScriptRules
  pool: 
    vmImage: 'ubuntu-latest'
  displayName: 'Run Python Script for Rules'
  condition: contains(variables['Build.SourceTfvcRunAllTests'], variables['ruleTrigger'])
  steps:
    - checkout: self
    - task: UsePythonVersion@0
      inputs:
        versionSpec: '3.x'
        addToPath: true
        architecture: 'x64'
    - script: |
        echo "Build.SourcePath: $(Build.SourceTfvcRunAllTests)"
        pip install -r requirements.txt
        python AUTOMATION/rule_generator.py
    - task: CopyFiles@2
      inputs:
        targetFolder: '$(Build.ArtifactStagingDirectory)'
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Build.ArtifactStagingDirectory)'
        ArtifactName: 'another_drop02'
        publishLocation: 'Container'
